{% extends "base.html" %}
{% import "macros/projects.html" as projects %}

{% block content %}

<h1>Tags &raquo; {{ term.name | capitalize }}</h1>

{% set sorted_pages = term.pages | sort(attribute="date") | reverse %}
<p>There are {{ sorted_pages | length }} entries for this tag, the first on {{ sorted_pages | last | get(key="date") | date(format="%d %B %Y") }} and the most recent on {{ sorted_pages | first | get(key="date") | date(format="%d %B %Y") }}.</p>

<article>

{% for year, posts in sorted_pages | group_by(attribute="year") %}
<hr>
<h2>{{ year }}</h2>

{% set gallery_posts = posts | filter (attribute="components.0", value="gallery") %}
{% set blog_posts = posts | filter (attribute="components.0", value="blog") %}
{% set project_posts = posts | filter (attribute="components.0", value="projects") %}

{% if gallery_posts | length > 0 %}
<div class="g">
{% for post in gallery_posts %}
{% if post.extra.images  -%}
{% for image in post.extra.images -%}
<a href="{{ post.permalink | safe }}" title="{{ post.title }} - {{ post.date }}">{{ images::responsive_thumbnail(path=post.colocated_path, src=image, default_size=128, sizes=[128,256], alt=post.title  ~ " - "  ~ post.date ) -}}</a>
{% endfor -%}
{% endif -%}
{% endfor -%}
</div>
{% endif -%}

{% if gallery_posts | length > 0 and blog_posts | length > 0 %}
<hr>
{% endif -%}

{% if blog_posts | length > 0 %}
<ul class="p">
  {% for post in blog_posts %}
  <li>
    <time datetime="{{ post.date }}"><span>{{ post.date | date(format='%d') }}</span><span class="s">{{ post.date | date(format='%b') }}</span></time>
    <div><a href="{{ post.permalink | safe }}">{{ post.title }}</a>{% if post.draft %} (Draft){% endif %}
    {{ hooks::posts_below_title(page=post) }}</div>
  </li>
  {% endfor %}
</ul>
{% endif -%}

{% if (gallery_posts | length > 0 or blog_posts | length > 0) and project_posts | length > 0 %}
<hr>
{% endif -%}

{% if project_posts | length > 0 %}
{% for post in project_posts %}
<div style="margin-bottom:1.5rem">
  <h3>Project &raquo; {% if post.extra.emoji %}{{ post.extra.emoji }}{% else %}ðŸ’¡{% endif %} <a href="{{ post.permalink | safe }}">{{ post.title }}</a>{% if post.draft %} (Draft){% endif %}</h3>
  <div style="display:flex;gap:1rem">
    {% if post.extra.cover %}<a href="{{ post.permalink | safe }}" style="width:2.5rem">{{ images::responsive_thumbnail(path="@", src=post.extra.cover, alt=post.title, default_size=48, sizes=[48,96]) }}</a>{% endif %}
    <div style="flex:1">
      {% if post.description %}<p class="s" style="margin:0">{{ post.description }}</p>{% endif %}
      {% if post.taxonomies.tags %}<ul class="tags s">{% for tag in post.taxonomies.tags %}<li><a href="/tags/{{ tag | slugify }}/">{{ tag }}</a></li>{% endfor %}</ul>{% endif %}
    </div>
  </div>
</div>
{% endfor %}
{% endif -%}
{% endfor %}


</article>
  
{% endblock content %}