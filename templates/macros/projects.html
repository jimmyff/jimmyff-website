
{# Returns all the values in a taxonmy, would be nice to sort by count #}

{% macro url(name) -%}

{% set project = get_taxonomy_term(kind="project", term=name)  %}
{% set page_exists = load_data(path="projects/"~project.slug~".md", required=false) -%}
{% if page_exists %}
{% set page = get_page(path="projects/"~project.slug~".md") %}
{{ page.permalink }}
{% else %}
{{ project.permalink }}
{% endif %}
{% endmacro url %}



{% macro summary(name, onpage=false) -%}

{% set project = get_taxonomy_term(kind="project", term=name)  %}

{%- set page_exists = load_data(path="projects/"~project.slug~".md", required=false) -%}
{% if page_exists %}
{% set page = get_page(path="projects/"~project.slug~".md") %}
{# <code>{{ page | json_encode(pretty=true) }}</code> #}
{% endif %}

<div class="project">
    {# <code>{{ project | json_encode(pretty=true) }}</code> #}


    <div class="project">

        {% if onpage %}


        <h1>
            {% if page and page.permalink  -%}
            Project {{ project.name }}
            {% else -%}
            Project {{ project.name }}
            {% endif -%}
        
        </h1>
        {% else %}

        <h3>
            {% if page and page.permalink  -%}
            <a href="{{ page.permalink | safe }}">Project {{ project.name }}</a>
            {% else -%}
            <a href="{{ project.permalink | safe }}">Project {{ project.name }}</a>
            {% endif -%}
        
        </h3>

        {% endif %}
        
            <div class="body">
        
                <div class="cover">
                    {% if page and page.extra and page.extra.cover -%}
                        {{ images::responsive_image(path="@", src=page.extra.cover, alt=project.name, default_size=config.extra.images_default_size, sizes=config.extra.images_sizes) }}
                    {% else -%}
                        <span class="emoji">ðŸ’¡</span>
                    {% endif -%}
                </div>
        
            {% set last = project.pages | last %}
                
              <div class="details">
                {% if page_exists and page.description %}
                <p>{{ page.description }}</p>
                {% endif -%}
        
        
                {# {{ taxonomies::values_for_pages(taxonmy=project, pages=project.items, label="") }} #}
                <div class="stats">
                    <div class="count blog">{{ project.pages | filter(attribute="ancestors.1", value="blog/_index.md") | length }}</div> 
                    
            
                    <div class="count gallery">{{ project.pages | filter(attribute="ancestors.1", value="gallery/_index.md") | length }}</div>
                
                    
                    
                {# <div  class="date">Created: <span>{{ last.date | date(format="%-d %B %Y") }}</span></div>
                {% if  last.date != project.pages.0.date -%}
             
                <div class="date">Updated: <span>{{ project.pages.0.date | date(format="%-d %B %Y") }}</span></div> 
                {% endif -%} #}
        
                <div class="date">Updated: <span>{{ project.pages.0.date | date(format="%B %Y") }}</span></div> 
             
                
                </div>
        
                {% if page and page.taxonomies and page.taxonomies["tags"] -%}
                <ul class="tags">
                    {% for tag in page.taxonomies["tags"] %}
                      <li><a href='{{ config.base_url | safe }}/tags/{{ tag | slugify }}'>{{ tag }}</a></li>
                    {% endfor %}
                  </ul>
                {% endif -%}
                 
              </div>
            </div>
        </div>

</div>


{% endmacro summary %}